{% extends 'base.html' %}
  
<head> 
  <meta charset="utf-8"> 
  <title>chartsjs</title> 
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"> 
  
  <!-- jQuery library -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script> 
  
  <!-- Latest compiled JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script> 
</head> 

{% block content %}

<!-- Movie Charts -->
 <div>

  <div id="text-container">
    <p class="text-center">Number of Movies Watched</p>
    <p class="text-center">{{ movie_count }}</p>
    
  </div>
  
  <div id="container" style="width: 100%;">
    <canvas id="movies_charts" data-url="{% url 'charts:movies_charts' %}"></canvas>
  </div>

 </div>


{% endblock content %}

  
{% block scripts %}
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
<script>

  const ctx = document.getElementById('movies_charts');
  $(function () {
  var $movies_charts = $("#movies_charts");

  console.log("Canvas found:", $movies_charts[0]);
  
  $.ajax({
      url: $movies_charts.data("url"),
      success: function (data) {
        console.log('AJAX data:', data);  // Debug: Check if data is correct

        // Check if data exists and is in the expected format
        if (data && Array.isArray(data.genre) && Array.isArray(data.movie)) {
          var ctx = $movies_charts[0].getContext("2d");

          // Log to ensure that the context is set up correctly
          console.log('Canvas context:', ctx);
          console.log('Canvas element:', $movies_charts[0]);

          // Initialize the chart
          new Chart(ctx, {
            type: 'bar',
            data: {
              labels: data.genre,
              datasets: [{
                label: 'Movies',
                backgroundColor: 'blue',
                data: data.movie
              }]
            },
            options: {
              responsive: true,
              legend: {
                position: 'top',
              },
              title: {
                display: true,
                text: 'Movie Genres'
              },
              scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }]
              }
            }
          });
        } else {
          console.error('Invalid data format:', data);
        }
      },
      error: function (err) {
        console.error("Error fetching data", err);
      }
    });
  });
</script>
{% endblock scripts %}
